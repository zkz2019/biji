<!-- 历史开门 -门禁 -->
<template>
  <fel-dialog
    title="历史开门"
    width="70%"
    minWidth="900px"
    :before-close="beforeClose"
    :visible.sync="dialogVisibleHistory"
  >
    <el-container class="mjhistory">
      <el-header class="query_headbox heig60">
        <retrieval class="query_head marpadbor0">
          <inpbox :inpb="true">
            <el-select class="con-select qh_inp" v-model="param.artype" placeholder="请选择" clearable>
              <el-option
                v-for="item in options"
                :key="item.type"
                :label="item.typename"
                :value="item.type"
              ></el-option>
            </el-select>
          </inpbox>
          <inpbox :inpb="true">
            <el-date-picker
              v-model="value1"
              type="daterange"
              range-separator="至"
              popper-class="fel-dateW miniDate"
              value-format="yyyy-MM-dd"
              start-placeholder="开始日期"
              end-placeholder="结束日期"
              class="con-daterange"
              size="mini"
            ></el-date-picker>
            <!-- <el-date-picker
              v-model="param.sdate"
              value-format="yyyy-MM-dd HH:mm:ss"
              type="datetime"
              size="mini"
              placeholder="请选择起始时间"
            ></el-date-picker>-->
          </inpbox>
          <inpbox :inpb="true">
            <el-input
              class="con-search qh_inp"
              clearable
              v-model="param.search"
              :placeholder="'输入卡片/姓名/学/工号进行检索'"
            ></el-input>
          </inpbox>
          <inpbox inpb>
            <el-button class="qh_btn" type="primary" @click="onRefresh">确定</el-button>
            <el-button class="qh_btn" @click="onResize">清空</el-button>
          </inpbox>
        </retrieval>
      </el-header>
      <el-main class="dialog-table6 query_main">
        <paging-table
          height="100%"
          interface="/access/info/2/getaccessrecord"
          class="heig100"
          @onSelection="onSelection"
          :list="list"
          :refresh="refresh"
          :param="param"
          :paramObj="paramObj"
          :noOpera="true"
        ></paging-table>
      </el-main>
    </el-container>
  </fel-dialog>
</template>

<script>
import { mapGetters } from "vuex";
export default {
  props: {
    paramObj: Object,
    dialogVisibleHistory: Boolean
  },
  name: "history",
  components: {},
  data() {
    let $this = this;
    return {
      value1: "",
      options: [{ typename: "全部", type: "" }],
      value: "",
      refresh: 0,
      param: {
        search: "",
        sdate: "",
        edate: "",
        artype: ""
      },
      list: [
        {
          name: "序号",
          type: "$index",
          width: "50px"
        },
        {
          name: "门禁位置",
          prop: "accesslocation"
        },
        {
          name: "门禁名称",
          prop: "accessname"
        },
        {
          name: "操作时间",
          prop: "arcdate"
        },
        {
          name: "卡片/指纹",
          prop: "arcode"
        },
        {
          name: "记录类型",
          prop: "artype"
        },
        {
          name: this.getNumber(),
          prop: "personcode"
        },
        {
          name: "归属组织",
          prop: "personlocation"
        },
        {
          name: "操作人员",
          prop: "personname"
        },
        {
          name: "读头名称",
          prop: "rhname"
        }
      ]
    };
  },
  created() {
    this.$ajax("/access/info/3/getrecordtype", {}, "1").then(res => {
      this.options = this.options.concat(res.result);
    });
  },
  methods: {
    ...mapGetters(["getNumber"]),
    onResize() {
      Object.keys(this.param).forEach(key => {
        this.param[key] = "";
      });
      this.value1 = "";
      this.refresh = new Date().getTime();
    },
    beforeClose() {
      this.$emit("beforeClose");
    },
    onRefresh() {
      //刷新表格
      if (this.value1) {
        this.param.sdate = this.value1[0];
        this.param.edate = this.value1[1];
      } else {
        this.param.sdate = "";
        this.param.edate = "";
      }
      this.refresh = new Date().getTime();
    },
    onSelection(data) {}
  }
};
</script>

<style lang="scss">
.mjhistory {
  height: 100%;
  .mjhistory_table {
    height: 400px;
  }
  .query_main {
    margin: 0;
    padding: 0;
  }
}
</style>

