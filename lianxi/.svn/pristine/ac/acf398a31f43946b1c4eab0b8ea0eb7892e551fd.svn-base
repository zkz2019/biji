<!-- 修改已选授权 -->
<template>
  <el-dialog
    title="修改已选授权"
    top="10%"
    width="60%"
    :close-on-click-modal="false"
    :before-close="beforeClose"
    :visible.sync="dialogVisible"
  >
    <fel-form
      @submitForm="onClick"
      width="160px"
      @closeForm="beforeClose"
      :defaultData="defaultData"
      dynamic
      :formData="formData"
    />
  </el-dialog>
</template>

<script>
import { format } from "@/utils/utils.js";
export default {
  props: {
    offLine: Boolean,
    dialogVisible: Boolean,
    param: Object,
    defaultData: {
      type: Object,
      default() {
        return {
          sdate: "",
          edate: "",
          openstime: "00:00",
          openetime: "23:59",
          usecount: ""
        };
      }
    }
  },
  data() {
    return {
      num: 1,
      button: [
        {
          type: "0",
          name: "清空"
        },
        {
          type: "2",
          name: "确认"
        }
      ],
      formData: [
        {
          value: "sdate",
          name: "授权开始日期",
          width: "50%",
          type: "date",
          date: "datetime",
          format: "yyyy-MM-dd HH:mm:ss"
        },
        {
          value: "edate",
          name: "授权结束日期",
          width: "50%",
          type: "date",
          date: "datetime",
          format: "yyyy-MM-dd HH:mm:ss"
        },
        {
          value: "openstime",
          name: "每日授权开始时间",
          width: "50%",
          type: "time",
          format: "HH:mm",
          rules: [
            {
              required: true,
              message: "请选择每日授权开始时间",
              trigger: "blur"
            }
          ]
        },
        {
          value: "openetime",
          name: "每日授权结束时间",
          width: "50%",
          type: "time",
          format: "HH:mm",
          rules: [
            {
              required: true,
              message: "请选择每日授权结束时间",
              trigger: "blur"
            }
          ]
        },
        // {
        //   value: "ismcard",
        //   name: "下发管理权限",
        //   width: "50%",
        //   type: "select",
        //   select: [
        //     { label: "是", value: "1" },
        //     { label: "否", value: "0" }
        //   ]
        // },
        {
          value: "ismcard",
          name: "下发管理权限",
          width: "50%",
          type: "checkbox",
          select: [
            { label: "是", value: "1" },
            { label: "否", value: "0" }
          ]
        },
        // {
        //   value: "isapp",
        //   name: "下发蓝牙钥匙权限",
        //   width:"50%",
        //   type: "select",
        //   select: [
        //     { label: "是", value: "1" },
        //     { label: "否", value: "0" }
        //   ]
        // },
        {
          value: "isfingerentry",
          name: "下发门锁录入指纹权限",
          width: "50%",
          type: "checkbox",
          select: [
            { label: "是", value: "1" },
            { label: "否", value: "0" }
          ]
        },
        {
          value: "isaddpass",
          name: "密码修改授权",
          width: "50%",
          type: "checkbox",
          select: [
            { label: "是", value: "1" },
            { label: "否", value: "0" }
          ]
        },
        {
          value: "issweep",
          name: "下发主扫权限",
          width: "50%",
          type: "checkbox",
          select: [
            { label: "是", value: "1" },
            { label: "否", value: "0" }
          ]
        },
        // {
        //   value: "isfingerentry",
        //   name: "下发门锁录入指纹权限",
        //   width:"50%",
        //   type: "select",
        //   select: [
        //     { label: "是", value: "1" },
        //     { label: "否", value: "0" }
        //   ]
        // },
        {
          value: "usecount",
          width: "50%",
          name: "可开门次数",
          type: "text",
          onInput: this.useInput
        }
      ]
    };
  },
  created() {
    if (this.offLine) {
      this.formData = [
        {
          value: "empsdate",
          name: "授权开始日期",
          type: "date",
          date: "datetime",
          format: "yyyy-MM-dd HH:mm:ss"
        },
        {
          value: "empedate",
          name: "授权结束日期",
          type: "date",
          date: "datetime",
          format: "yyyy-MM-dd HH:mm:ss"
        },
        {
          value: "opencount",
          name: "授权次数",
          type: "text",
          onInput: this.useInput
        }
      ];
    }
  },
  methods: {
    useInput(arr) {
      this.num = arr;
      if (arr == "") {
        this.num = 1;
      }
    },
    beforeClose() {
      this.$emit("beforeClose");
    },
    onClick(data) {
      // let obj = {
      //   sdate: format(data.sdate, "yyyy-MM-dd HH:mm:ss"),
      //   edate: format(data.edate, "yyyy-MM-dd HH:mm:ss"),
      //   openstime: format(data.openstime, "HH:mm"),
      //   openetime: format(data.openetime, "HH:mm"),
      //   usecount: data.usecount
      // };
      //判断是否为整数
      let num = /^\d+$/;
      // console.log(this.num >= 255 ,this.num <= 0,!num.test(this.num))
      if (this.num >= 255 || this.num <= 0 || !num.test(this.num)) {
        console.log("1", this.num);
        this.$message({
          message: "授权次数必须为大于0小于255的整数",
          type: "error"
        });
        return;
      }
      this.$emit("confirm", data);
    }
  }
};
</script>
