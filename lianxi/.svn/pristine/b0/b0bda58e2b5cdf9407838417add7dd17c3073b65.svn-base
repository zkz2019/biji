import Storages from "../../utils/Storage.js"; //缓存工具
import {
    ajax
} from '@/request/http.js'
const dictionary = {
    state: {
        dictionary: Storages.getStorage("dictionary") || {}, //数字字典
    },
    mutations: {
        setDictionary(state, data) {
            state.dictionary = data;
            Storages.setStorage("dictionary", state.dictionary);
        }
    },
    getters: {
        // 编号
        getNumber(state) {
            return state.dictionary["personcode|1"] || "编号"
        },
        // 公共房间细分
        getRoomnexttype: (state) => (id) => {
            if (id) {
                return state.dictionary["roomnexttype|" + id];
            } else {
                let obj = {};
                Object.keys(state.dictionary).filter(key => {
                    return key.includes("roomnexttype|");
                }).forEach(key => {
                    obj[key.replace("roomnexttype|", "")] = state.dictionary[key];
                });
                return obj;
            }
        },
        // 建筑房间类型
        getRoomtype2: (state) => (id) => {
            if (id) {
                return state.dictionary["roomtype2|" + id];
            } else {
                let obj = {};
                Object.keys(state.dictionary).filter(key => {
                    return key.includes("roomtype2|");
                }).forEach(key => {
                    obj[key.replace("roomtype2|", "")] = state.dictionary[key];
                });
                return obj;
            }
        },
    },
    actions: {
        getDiction({
            state,
            commit
        }) {
            return new Promise((resolve, reject) => {
                ajax("/login/home/8/getwordbook", {}, "1").then(res => {
                    let result = res.result;
                    let obj = {};
                    if (result) {
                        result.forEach(element => {
                            obj[element.ddtype + "|" + element.wbdcode] = element.wbdvalue;
                        });
                        commit("setDictionary", obj);
                    }
                    resolve();
                }).catch(err => {
                    reject(err)
                });

            });
        },
    }
}
export default dictionary