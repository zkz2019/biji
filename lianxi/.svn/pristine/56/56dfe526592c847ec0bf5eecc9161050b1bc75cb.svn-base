<template>
  <el-dialog
    :title="title"
    class="dialog"
    :close-on-click-modal="false"
    :before-close="beforeClose"
    :visible.sync="dialogVisible"
  >
    <fel-form
      class="single-row"
      ref="felForm"
      :defaultData="defaultData"
      @closeForm="closeForm"
      width="150px"
      :formData="fData()"
      v-on="$listeners"
      dynamic
    ></fel-form>
  </el-dialog>
</template>

<script>
/**
 * element-ui中 el-dialog 弹出框
 * 弹出框是懒渲染 只会渲染一次
 * closeData 关闭弹出框 数字，改变值就关闭
 * openData 显示弹出框 数字，改变值就显示
 * top 里顶部位置
 * button 是否带确认关闭两个按钮
 * 支持插槽插入内容
 * 有确认关闭两个按钮
 * @closeForm 点击关闭按钮触发事件
 * @submitForm 点击确认按钮触发事件
 */
// import felForm from "./fel-form";
export default {
  name: "ty-el-dialog",
  props: [
    "dialogVisible",
    "defaultData",
    "title"
  ],
  data() {
    return {
      formLabelWidth: "120px",
      formData: [
        {
          value: "uppgname",
          name: "上级组织名称",
          type: "text",
          disabled: true
        },
        {
          value: "pgcode",
          name: "新建下级组织编号",
          type: "text",
          rules: [
            { required: true, message: "请输入下级组织编号", trigger: "blur" }
          ]
        },
        {
          value: "pgname",
          name: "新建下级组织名称",
          type: "text",
          rules: [
            { required: true, message: "请输入下级组织名称", trigger: "blur" }
          ]
        }
      ],
       modifyData: [
        {
          value: "uppgname",
          name: "上级组织",
          type: "text",
          disabled: true
        },
        {
          value: "pgcode",
          name: "组织编号",
          type: "text",
          rules: [
            { required: true, message: "组织编号不能为空", trigger: "blur" }
          ]
        },
        {
          value: "pgname",
          name: "组织名称",
          type: "text",
          rules: [
            { required: true, message: "组织名称不能为空", trigger: "blur" }
          ]
        }
      ],
    };
  },
  mounted() {
    if (this.top) {
      const el = this.$el;
      if (el && el.querySelector("div.el-dialog")) {
        el.querySelector("div.el-dialog").style.marginTop = this.top;
      }
    }
  },
  methods: {
    fData(){
       if(this.title=="添加组织"){
         return this.formData;
       }else if(this.title=="修改组织"){
         return this.modifyData;
       }
    },
    beforeClose() {
      // if (this.$refs["felForm"]) {
      //   this.$refs["felForm"].resetForm();
      // }
      this.$emit("beforeClose");
    },
    closeForm: function() {
      if (this.$refs["felForm"]) {
        this.$refs["felForm"].resetForm();
      }
      this.$emit("beforeClose");
    },
    submitForm: function() {
      this.$emit("submitForm");
    }
  },
  watch: {
    dialogVisible() {
      if (this.dialogVisible == false && this.$refs["felForm"]) {
        this.$refs["felForm"].resetForm();
      }
    }
  }
};
</script>
