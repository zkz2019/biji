<template>
  <el-dialog
    :title="title"
    width="70%"
    class="importHistory"
    :close-on-click-modal="false"
    append-to-body
    :before-close="beforeClose"
    :visible.sync="dialogVisible"
  >
    <el-container class="dialog-table6 query_main">
      <paging-table :interface="historyUrl" :list="list" :param="param" :refresh="refresh">
        <!-- class="query_head">
          <inpbox inptext="请输入">
            <el-input
              clearable
              class="qh_w270 qh_inp maR24"
              v-model="param.search"
              :placeholder="'输入账号/姓名进行检索'"
            ></el-input>
          </inpbox>
          <inpbox>
            <fel-button class="qh_btn" type="primary" @click="search">查询</fel-button>
            <fel-button class="qh_btn" @click="onReset">重置</fel-button>
          </inpbox>
        </!-->
      </paging-table>
    </el-container>
    <!-- <exportDetails
      :dialogDetailed="dialogDetailed"
      :eeid="param1.eeid"
      :detailsUrl="detailsUrl"
      :failUrl="failUrl"
      :listObj="listObj"
      @beforeDetailed="beforeDetailed"
    ></exportDetails>-->
  </el-dialog>
</template>

<script>
// import exportDetails from "./export-details";
import { download } from "@/utils/utils.js";
import { mapGetters } from "vuex";
export default {
  props: {
    dialogVisible: Boolean,
    eeid: String | Number,
    detailsUrl: String,
    historyUrl: String,
    failUrl: String
  },
  // components: { exportDetails },
  data() {
    let $this = this;
    return {
      interface: "",
      title: "导出历史",
      types: [
        // { id: "", name: "全部" },
        // { id: "1", name: "入住导入" },
        // { id: "2", name: "退宿导入" },
        // { id: "3", name: "比对导入" },
        // { id: "4", name: "公共房间授权导入" }
      ],
      refresh: 0,
      detailedRefresh: 0,
      dialogDetailed: false,
      param: { type: "", search: "" },
      param1: { eeid: "" },
      listObj: {},
      list: [
        {
          name: "序号",
          type: "$index",
          width: "60px"
        },
        {
          name: "导出时间",
          prop: "eecdate"
        },
        {
          name: "导出文件数",
          prop: "eecount"
        },
        {
          name: "导出成功数",
          prop: "eeokcount"
        },
        {
          name: "导出失败数",
          prop: "eenocount"
        },
        {
          name: "操作账号",
          prop: "userlogin"
        },
        {
          name: "操作",
          width: "100px",
          template: {
            props: ["scope"],
            methods: {
              onClick() {
                window.location = "/downzip/" + this.scope.row.eefilename;
                // window.location = "https://test.keenzy.cn/downzip/" + this.scope.row.eefilename;
              }
            },
            template: `<div class="operat-buts"> 
             <el-button v-if="scope.row.eefilename" type="text" size="small" @click.stop="onClick">下载</el-button>
            </div>`
          }
        }
      ]
    };
  },
  watch: {
    dialogVisible(val) {
      if (val) {
        this.onRefresh();
      }
    }
  },
  methods: {
    ...mapGetters(["getNumber"]),
    beforeClose() {
      this.$emit("beforeClose");
    },
    beforeDetailed() {
      this.dialogDetailed = false;
    },
    onClick(id, obj) {
      console.log("click", id, obj);
      this.listObj = obj;
      this.param1.eeid = obj.data.eeid;
      this.dialogDetailed = true;
    },
    // search() {
    //   this.onRefresh();
    // },
    // onReset() {
    //   Object.keys(this.param).forEach(item => {
    //     this.param.search = "";
    //   });
    //   this.onRefresh();
    // },
    onRefresh() {
      this.refresh = new Date().getTime();
    }
  }
};
</script>

<style lang="scss">
.importHistory {
  .query_head {
    margin: 0;
  }
}
</style>