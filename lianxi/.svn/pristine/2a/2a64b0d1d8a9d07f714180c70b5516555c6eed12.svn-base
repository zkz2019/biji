<!-- 记录查询 -门禁 -->
<template>
  <fel-dialog
    :title="title||'记录查询'"
    width="70%"
    minWidth="1050px"
    :before-close="beforeClose"
    :visible.sync="dialogVisibleHistory"
  >
    <el-container class="mjhistory">
      <el-header class="query_headbox heig60">
        <retrieval class="query_head marpadbor0">
          <inpbox :inpb="true">
            <el-date-picker
              v-model="value1"
              type="datetimerange"
              range-separator="至"
              start-placeholder="开始日期"
              end-placeholder="结束日期"
              :picker-options="pickerOptions"
              class="con-daterange"
              size="mini"
              value-format="yyyy-MM-dd HH:mm:ss"
              :clearable="false"
              popper-class="fel-dateW miniDate"
            ></el-date-picker>
            <!-- <el-date-picker
              v-model="value1"
              type="daterange"
              range-separator="至"
              popper-class="fel-dateW miniDate"
              value-format="yyyy-MM-dd"
              start-placeholder="开始日期"
              end-placeholder="结束日期"
              class="con-daterange"
              :picker-options="pickerOptions"
              size="mini"
              :clearable="false"
            ></el-date-picker>-->
            <!-- <el-date-picker
              v-model="param.sdate"
              value-format="yyyy-MM-dd HH:mm:ss"
              type="datetime"
              size="mini"
              placeholder="请选择起始时间"
            ></el-date-picker>-->
          </inpbox>
          <!-- <inpbox :inpb="true">
            <el-select class="con-select qh_inp" v-model="param.aaa" placeholder="请选择" clearable>
              <el-option
                v-for="item in options1"
                :key="item.id"
                :label="item.name"
                :value="item.id"
              ></el-option>
            </el-select>
          </inpbox>-->
          <inpbox :inpb="true">
            <el-select
              class="con-select qh_inp mjSelwid"
              v-model="param.artype3"
              placeholder="请选择"
              clearable
            >
              <el-option
                v-for="item in artype3s"
                :key="item.id"
                :label="item.name"
                :value="item.id"
              ></el-option>
            </el-select>
          </inpbox>
          <inpbox :inpb="true">
            <el-select
              class="con-select qh_inp mjSelwid"
              v-model="param.artype2"
              placeholder="请选择"
              clearable
            >
              <el-option v-for="item in options" :key="item.id" :label="item.name" :value="item.id"></el-option>
            </el-select>
          </inpbox>
          <inpbox :inpb="true">
            <el-select
              class="con-select qh_inp mjSelwid"
              v-model="param.artype"
              placeholder="请选择"
              clearable
            >
              <el-option
                v-for="item in typeOptions"
                :key="item.id"
                :label="item.name"
                :value="item.id"
              ></el-option>
            </el-select>
          </inpbox>

          <inpbox :inpb="true">
            <el-input
              class="con-search qh_inp"
              clearable
              v-model="param.search"
              :placeholder="'输入人员工号/姓名进行检索'"
            ></el-input>
          </inpbox>
          <inpbox inpb>
            <el-button class="qh_btn" type="primary" @click="onRefresh">查询</el-button>
            <el-button class="qh_btn" @click="onResize">重置</el-button>
          </inpbox>
        </retrieval>
      </el-header>
      <el-main class="dialog-table6 query_main">
        <paging-table
          height="100%"
          interface="/access/v2.0/door/4/listAccessDoorRecord"
          class="heig100"
          @onSelection="onSelection"
          :list="list"
          ajaxType="9"
          :refresh="refresh"
          :param="param"
          :paramObj="{adid:paramObj.adid}"
        ></paging-table>
      </el-main>
    </el-container>
  </fel-dialog>
</template>

<script>
import { format } from "@/utils/utils.js";
import { mapGetters } from "vuex";
export default {
  props: {
    // checkedroom: Object,
    paramObj: Object,
    dialogVisibleHistory: Boolean
  },
  name: "history",
  components: {},
  data() {
    let $this = this;
    return {
      value1: [],
      options: [],
      title: "",
      artype3s: [{ name: "全部方向", id: "" }],
      options1: [
        { name: "全部门禁类型", id: "" },
        { name: "双门双控", id: "1" },
        { name: "单门单控", id: "2" }
      ],
      typeOptions: [{ name: "全部记录类型", id: "" }],
      value: "",
      refresh: 0,
      param: {
        search: "",
        aredate: "",
        arsdate: "",
        artype: "",
        artype2: "",
        artype3: ""
      },
      pickerOptions: {
        disabledDate(time) {
          return time.getTime() > new Date().getTime();
        }
      },
      list: [
        {
          name: "序号",
          type: "$index",
          width: "50px"
        },
        {
          name: "操作时间",
          prop: "ardate"
          //       template: {
          //         props: ["scope"],
          //         methods: {
          //           onClick() {}
          //         },
          //         template: `<el-tooltip class="item" effect="dark" :content="'组织:'+scope.row.personlocation" placement="right-start">
          //   <a>{{scope.row.personname}}</a>
          // </el-tooltip>`
          //       }
        },
        {
          name: "位置",
          prop: "aglocation",
          show: true
        },
        {
          name: "所属门禁",
          prop: "amname",
          show: true
        },
        {
          name: "门名称",
          prop: "adname",
          show: true
        },
        {
          name: "方向",
          prop: "artype3"
        },

        {
          name: "动作",
          prop: "artype2"
        },
        {
          name: "记录类型",
          prop: "artype"
        },
        {
          name: "记录详情",
          prop: "cardcode"
        },
        {
          name: "人员编号",
          prop: "personcode"
        },
        // {
        //   name: this.getNumber(),
        //   prop: "personcode"
        // },
        {
          name: "姓名",
          prop: "personname"
        },
        {
          name: "归属组织",
          prop: "personlocation"
        }
      ]
    };
  },
  computed: {
    roomid() {
      // this.param.roomid = this.$store.state.fj38.checkedroom.roomid + "";
      //   return this.$store.state.fj38.checkedroom.roomid + "";
    }
  },
  watch: {
    dialogVisibleHistory(val) {
      if (val) {
        this.setDates();
        this.onRefresh();
      }
    },
    value1(val) {
      // this.param.sdate = val[0];
      // this.param.edate = val[1];
    },
    roomid() {},
    checkedroom(val) {
      //   this.param.roomid = val.checkedroom.roomid;
    }
  },
  created() {
    // let k = format(, "yyyy-MM-dd");
    this.getTypes();
  },
  methods: {
    setDates() {
      let T = new Date();
      T.setDate(1);
      let date = [
        format(T, "yyyy-MM-dd") + " 00:00:00",
        format(new Date(), "yyyy-MM-dd HH:mm:ss")
      ];
      this.value1 = date;
    },
    getTypes() {
      this.$ajax("/access/v2.0/door/3/getAccessDoorRecordState", {}, "9")
        .then(res => {
          this.typeOptions = this.typeOptions.concat(res.result.artypes);
          this.options = this.options.concat(res.result.artype2s);
          this.artype3s = this.artype3s.concat(res.result.artype3s);
        })
        .catch(err => {
          console.log("err", err);
        });
    },
    ...mapGetters(["getNumber"]),
    onResize() {
      Object.keys(this.param).forEach(key => {
        this.param[key] = "";
      });
      this.setDates();
      this.onRefresh();
    },
    beforeClose() {
      this.$emit("beforeClose");
    },
    onRefresh() {
      //刷新表格
      if (this.value1) {
        this.param.arsdate = this.value1[0];
        this.param.aredate = this.value1[1];
      } else {
        this.param.arsdate = "";
        this.param.aredate = "";
      }
      this.refresh = new Date().getTime();
    },
    onSelection(data) {}
  }
};
</script>

<style lang="scss">
.mjhistory {
  height: 100%;
  .mjhistory_table {
    height: 400px;
  }
  .query_main {
    margin: 0;
    padding: 0;
  }
  .mjSelwid {
    width: 150px;
  }
}
</style>

