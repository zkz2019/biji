<!-- 添加卡片 修改卡片授权 -->
<template>
  <el-dialog
    title="修改卡片授权"
    width="60%"
    :close-on-click-modal="false"
    :before-close="beforeClose"
    :visible.sync="dialogVisible"
  >
    <fel-form
      ref="felForm"
      @submitForm="onClick"
      @closeForm="beforeClose"
      width="140px"
      dynamic
      :defaultData="defaultFormData"
      :formData="ismj?mjformData:formData"
    />
  </el-dialog>
</template>

<script>
import { format } from "@/utils/utils.js";
export default {
  props: {
    type: String,
    param: Object,
    ismj: Boolean,
    defaultData: {
      type: Object,
      default() {
        return {};
      }
    },
    list: Array,
    dialogVisible: Boolean
  },
  data() {
    return {
      button: [
        {
          type: "0",
          name: "清空"
        },
        {
          type: "2",
          name: "确认"
        }
      ],
      formData: [
        {
          width: "50%",
          value: "cardtype",
          name: "卡片类型",
          type: "text",
          disabled: true
        },
        {
          width: "50%",
          value: "cardcode",
          name: "卡号",
          type: "text",
          disabled: true
        },
        {
          width: "50%",
          display: "block",
          value: "personname",
          name: "使用人",
          type: "text",
          disabled: true
        },
        {
          width: "50%",
          value: "empsdate",
          name: "授权开始日期",
          popperClass: "dateQueryListMax",
          type: "date",
          date: "datetime",
          format: "yyyy-MM-dd HH:mm:ss"
        },
        {
          width: "50%",
          value: "empedate",
          popperClass: "dateQueryListMax",
          name: "授权结束日期",
          type: "date",
          date: "datetime",
          format: "yyyy-MM-dd HH:mm:ss"
        },
        {
          width: "50%",
          value: "openstime",
          name: "每日授权开始时间",
          type: "time",
          format: "HH:mm",
          rules: [
            {
              required: true,
              message: "请选择每日授权开始时间",
              trigger: "blur"
            }
          ]
        },
        {
          width: "50%",
          value: "openetime",
          name: "每日授权结束时间",
          type: "time",
          format: "HH:mm",
          rules: [
            {
              required: true,
              message: "请选择每日授权结束时间",
              trigger: "blur"
            }
          ]
        },
        {
          width: "50%",
          value: "opencount",
          name: "开门使用次数",
          maxlength: 4,
          type: "text"
        }
      ],
      mjformData: [
        {
          width: "50%",
          value: "cardtype",
          name: "卡片类型",
          type: "text",
          disabled: true
        },
        {
          width: "50%",
          value: "cardcode",
          name: "卡号",
          type: "text",
          disabled: true
        },
        {
          width: "50%",
          display: "block",
          value: "personname",
          name: "使用人",
          type: "text",
          disabled: true
        },
        {
          width: "50%",
          value: "aucempsdate",
          name: "授权开始日期",
          popperClass: "dateQueryListMax",
          type: "date",
          date: "datetime",
          format: "yyyy-MM-dd HH:mm:ss",
          // rules: [
          //   {
          //     required: true,
          //     message: "请选择授权开始日期",
          //     trigger: "blur"
          //   }
          // ]
        },
        {
          width: "50%",
          value: "aucempedate",
          popperClass: "dateQueryListMax",
          name: "授权结束日期",
          type: "date",
          date: "datetime",
          format: "yyyy-MM-dd HH:mm:ss",
          // rules: [
          //   {
          //     required: true,
          //     message: "请选择授权结束日期",
          //     trigger: "blur"
          //   }
          // ]
        },
        {
          width: "50%",
          value: "aucopenstime",
          name: "每日授权开始时间",
          type: "time",
          format: "HH:mm",
          rules: [
            {
              required: true,
              message: "请选择每日授权开始时间",
              trigger: "blur"
            }
          ]
        },
        {
          width: "50%",
          value: "aucopenetime",
          name: "每日授权结束时间",
          type: "time",
          format: "HH:mm",
          rules: [
            {
              required: true,
              message: "请选择每日授权结束时间",
              trigger: "blur"
            }
          ]
        },
        {
          width: "50%",
          value: "aucusecount",
          name: "开门使用次数",
          maxlength: 4,
          type: "text",
          // rules: [
          //   {
          //     required: true,
          //     message: "请填写开门使用次数",
          //     trigger: "blur"
          //   }
          // ]
        }
      ]
    };
  },
  watch: {
    dialogVisible() {}
  },
  computed: {
    defaultFormData() {
      let obj = {
        cardtype: this.param.cardtype,
        cardcode: this.param.cardcode,
        personname: this.param.personname,
        empsdate: "",
        empedate: "",
        openstime: "00:00",
        openetime: "23:59",
        opencount: ""
      };
      Object.keys(this.defaultData).forEach(key => {
          obj[key] = this.defaultData[key];
      });
      return obj;
    }
  },
  methods: {
    beforeClose() {
      if (this.$refs["felForm"]) {
        this.$refs["felForm"].resetForm();
      }
      this.$emit("beforeClose");
    },
    onClick(data) {
      // let obj = {
      //   empsdate: format(data.empsdate, "yyyy-MM-dd HH:mm:ss"),
      //   empedate: format(data.empedate, "yyyy-MM-dd HH:mm:ss"),
      //   openstime: format(data.openstime, "HH:mm"),
      //   openetime: format(data.openetime, "HH:mm"),
      //   opencount: data.opencount
      // };
      this.$emit("confirm", data);
    }
  }
};
</script>
