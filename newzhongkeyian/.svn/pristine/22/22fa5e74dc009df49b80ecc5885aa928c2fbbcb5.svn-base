<!-- 人员信息 -->
<template>
  <fel-dialog
    class="queryPersonInfo"
    top="5%"
    title="人员信息"
    width="85%"
    append-to-body
    min-width="900px"
    :close-on-click-modal="false"
    :before-close="beforeClose"
    :visible.sync="dialog"
  >
    <el-tabs v-model="activeName" @tab-click="handleClick">
      <el-tab-pane v-for="item in tobHead" :label="item.label" :name="item.name">
        <!-- <jcxxInfo v-bind="$attrs"></jcxxInfo> -->
        <!-- <component :is="jcxxInfo" v-bind="$attrs"></component> -->
      </el-tab-pane>
      <!-- <el-tab-pane label="授权门锁信息" name="second">
        <msInfo v-bind="$attrs"></msInfo>
      </el-tab-pane>
      <el-tab-pane label="授权门禁信息" name="third">
        <mjInfo v-bind="$attrs"></mjInfo>
      </el-tab-pane>-->
    </el-tabs>
    <div>
      <component :is="isCom" v-bind="$attrs" :buts="isButs"></component>
    </div>
  </fel-dialog>
</template>

<script>
import jcxxInfo from "./jcxxInfo.vue";
import msInfo from "./msInfo.vue";
import mjInfo from "./mjInfo.vue";
import { format } from "@/utils/utils.js";
export default {
  components: {
    jcxxInfo,
    msInfo,
    mjInfo,
  },
  props: {
    dialogVisible: Boolean,
  },
  data() {
    let $this = this;
    return {
      buts: [],
      mjbuts: [],
      msbuts: [],
      isButs: [],
      activeName: "first",
      isCom: "",
    };
  },
  watch: {
    dialogVisible(val) {
      if (val) {
        this.isCom = this.tobHead && this.tobHead[0] && this.tobHead[0].comp;
        this.activeName =
          this.tobHead && this.tobHead[0] && this.tobHead[0].name;
      } else {
        this.activeName = "first";
      }
    },
    activeName(val) {
      if (val == "second") {
        this.isButs = this.msbuts;
      } else if (val == "third") {
        this.isButs = this.mjbuts;
      }
    },
  },
  computed: {
    dialog() {
      let bool1 = this.tobHead && this.tobHead[0] && this.tobHead[0];
      let bool2 = this.buts && this.buts.entity && this.buts.entity.id == 963;
      let bool = Boolean(bool1) && Boolean(bool2);
      if (bool) {
        return this.dialogVisible;
      } else {
        return false;
      }
    },
    tobHead() {
      let head = [];
      if (this.buts && this.buts.childs) {
        this.buts.childs.forEach((item) => {
          if (item.entity.id == "964") {
            head.push({
              label: "基础信息",
              name: "first",
              comp: jcxxInfo,
            });
          } else if (item.entity.id == "965") {
            head.push({
              label: "授权门锁信息",
              name: "second",
              comp: msInfo,
            });
            this.msbuts = item.childs;
          } else if (item.entity.id == "966") {
            head.push({
              label: "授权门禁信息",
              name: "third",
            });
            this.mjbuts = item.childs;
          }
        });
      }
      return head;
    },
  },
  created() {
    this.inGetsonmenu();
  },
  methods: {
    inGetsonmenu() {
      this.$ajax("/login/home/2/getsonmenu", { fatherid: "302" }, "1")
        .then((res) => {
          this.buts = res.result[2];
          console.log("res", res);
          this.sonmenu = 4;
        })
        .catch((err) => {
          if (this.sonmenu < 3) {
            setTimeout(() => {
              this.sonmenu++;
              this.inGetsonmenu();
            }, 1000);
          }
        });
    },
    handleClick(val) {
      if (val.name == "first") {
        this.isCom = jcxxInfo;
      } else if (val.name == "second") {
        this.isCom = msInfo;
      } else if (val.name == "third") {
        this.isCom = mjInfo;
      }
      console.log("val", val.name);
    },
    beforeClose() {
      this.$emit("beforeClose");
    },
  },
};
</script>

<style lang="scss">
.queryPersonInfo {
  .msInfo {
    height: 500px;
    display: flex;
    flex-direction: column;
  }
  .jcxxInfo {
    min-height: 250px;
    .config_null {
      height: 100%;
      text-align: center;
      line-height: 300px;
    }
  }
}
</style>
