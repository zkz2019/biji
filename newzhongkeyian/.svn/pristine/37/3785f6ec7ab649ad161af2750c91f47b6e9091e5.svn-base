<!-- 操作记录 -门禁 -->
<template>
  <fel-dialog
    title="门禁授权操作记录"
    width="70%"
    minWidth="1050px"
    append-to-body
    :before-close="beforeClose"
    :visible.sync="dialogVisible"
  >
    <el-container class="mjRecord">
      <paging-table
        height="100%"
        interface="/access/v2.0/auth/info/f/listCardAccessAuthManage"
        class="heig100"
        :list="list"
        ajaxType="9"
        :refresh="refresh"
      ></paging-table>
    </el-container>
    <historyDetails
      :paramObj="paramDetails"
      :dialogVisible="dialogVisibleDetails"
      @beforeClose="dialogVisibleDetails=false"
    ></historyDetails>
  </fel-dialog>
</template>

<script>
import historyDetails from "./historyDetails";
import { mapGetters } from "vuex";
export default {
  props: {
    paramObj: Object,
    dialogVisible: Boolean
  },
  name: "record",
  components: { historyDetails },
  data() {
    let $this = this;
    return {
      refresh: 0,
      param: {},
      paramDetails: {},
      dialogVisibleDetails: false,
      list: [
        {
          name: "序号",
          type: "$index",
          width: "50px"
        },
        {
          name: "操作日期",
          prop: "aamcdate"
        },
        {
          name: "处理总数",
          prop: "aamcount"
        },
        {
          name: "处理失败数",
          prop: "aamnocount"
        },
        {
          name: "处理成功数",
          prop: "aamokcount"
        },
        {
          name: "操作账号",
          prop: "userlogin"
        },
        {
          name: "操作人",
          prop: "username"
        },
        {
          name: "操作",
          width: "150px",
          template: {
            props: ["scope"],
            methods: {
              onClick() {
                $this.onClick(this.scope.row);
              }
            },
            template: `<div class="operat-buts"> 
      <fel-button type="text" size="small" @click.stop="onClick">详情</fel-button>
</div>`
          }
        }
      ]
    };
  },
  computed: {},
  watch: {
    dialogVisible(val) {
      if (val) {
        this.onRefresh();
      }
    }
  },
  created() {},
  methods: {
    ...mapGetters(["getNumber"]),
    beforeClose() {
      this.$emit("beforeClose");
    },
    onRefresh() {
      //刷新表格
      this.refresh = new Date().getTime();
    },
    onClick(obj) {
      this.paramDetails = { authid: obj.aamid };
      this.dialogVisibleDetails = true;
    }
  }
};
</script>

<style lang="scss">
.mjRecord {
  height: 480px;
}
</style>

